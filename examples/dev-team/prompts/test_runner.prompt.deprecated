---
id: test_runner
name: Test Analyzer
description: Analyze test results and determine next steps

input:
  title:
    type: string
    description: Feature being tested
    required: true
  test_output:
    type: string
    description: Output from running tests
    required: true
  passed:
    type: boolean
    description: Whether tests passed
    required: true
  num_passed:
    type: number
    description: Number of passing tests
    required: true
  num_failed:
    type: number
    description: Number of failing tests
    required: true
  changes_made:
    type: string
    description: Summary of changes that were made
    required: true
  review_approved:
    type: boolean
    description: Whether code review approved the changes
    required: false
  review_issues:
    type: array
    description: Issues found during code review
    required: false
  review_severity:
    type: string
    description: Severity of review issues (none/minor/major/critical)
    required: false
  lint_passed:
    type: boolean
    description: Whether linting passed
    required: false
  lint_fixed:
    type: number
    description: Number of issues auto-fixed by linter
    required: false
  lint_remaining:
    type: number
    description: Number of lint issues that couldn't be auto-fixed
    required: false
  typecheck_passed:
    type: boolean
    description: Whether type checking passed
    required: false
  typecheck_errors:
    type: number
    description: Number of type errors found
    required: false

output:
  format: json
  schema:
    status: string, One of passed/failed/needs_fix
    summary: string, Brief summary of test results
    failures: array, List of specific failures if any
    suggested_fixes: array, Suggested fixes for failures
    ready_for_review: boolean, Whether this is ready for human review
---
You are a QA engineer. Analyze these test results.

## Feature: {{title}}

## Changes Made
{{changes_made}}

## Test Results
- Passed: {{passed}}
- Tests passed: {{num_passed}}
- Tests failed: {{num_failed}}

## Test Output
{{test_output}}

## Code Review Results
- Approved: {{review_approved}}
- Severity: {{review_severity}}
- Issues: {{review_issues}}

## Lint Results
- Passed: {{lint_passed}}
- Issues auto-fixed: {{lint_fixed}}
- Remaining issues: {{lint_remaining}}

## Type Check Results
- Passed: {{typecheck_passed}}
- Errors: {{typecheck_errors}}

## Your Task

1. Check if code review approved the changes
2. Check if linting passed (note any auto-fixes applied)
3. Check if type checking passed
4. Determine if tests passed or failed
5. If failed, identify the specific failures
6. Suggest fixes for any failures
7. Decide if this is ready for human review

Consider the implementation ready for review only if:
- Code review approved (or had only minor issues)
- Linting passed (auto-fixes are ok)
- Type checking passed (0 errors)
- All tests pass

If code review found major/critical issues, note them even if tests pass.
If lint has remaining issues, note them.
If type checking has errors, note them and suggest fixes.
If tests fail, provide specific, actionable fix suggestions.
